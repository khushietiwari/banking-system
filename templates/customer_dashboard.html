{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PrimeTrust Bank ‚Ä¢ Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>

/* ===== GLOBAL ===== */
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0b1f3a, #102a4d);
    color: white;
}

/* ===== ALERTS ===== */
.alert-message {
    padding: 14px 18px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-weight: 500;
}

.alert-message.error {
    background: #fee2e2;
    color: #991b1b;
}

.alert-message.success {
    background: #dcfce7;
    color: #166534;
}

/* ===== LAYOUT ===== */
.dashboard-container {
    display: flex;
    min-height: 100vh;
}

/* ===== SIDEBAR ===== */
.sidebar {
    width: 240px;
    background: rgba(0,0,0,0.25);
    backdrop-filter: blur(6px);
    padding: 30px 20px;
    border-right: 1px solid rgba(255,255,255,0.08);
}

.sidebar h3 {
    font-weight: 700;
    margin-bottom: 25px;
}

.sidebar a {
    display: block;
    color: rgba(255,255,255,0.85);
    text-decoration: none;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 6px;
    transition: 0.3s;
}

.sidebar a:hover {
    background: rgba(255,255,255,0.08);
    color: white;
}

.logout-btn {
    background: none;
    border: none;
    color: #ffb3b3;
    padding: 10px;
    width: 100%;
    text-align: left;
}

/* ===== MAIN ===== */
.main-content {
    flex: 1;
    padding: 35px;
}

/* ===== TOP BAR ===== */
.top-bar {
    display: flex;
    align-items: center;
    margin-bottom: 25px;
}

.profile-circle {
    width: 42px;
    height: 42px;
    background: white;
    color: #102a4d;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

/* ===== BALANCE CARD ===== */
.balance-card {
    background: linear-gradient(135deg, #ffffff, #dfe6ee);
    border-radius: 20px;
    padding: 35px;
    color: #102a4d;
    margin-bottom: 30px;
}

.balance-card h1 {
    font-weight: 700;
}

/* ===== ACTION GRID ===== */
.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 18px;
}

/* ===== ACTION BOX ===== */
.action-box {
    background: white;
    border-radius: 16px;
    padding: 22px;
    color: #102a4d;
    text-align: center;
    transition: 0.3s;
}

.action-box:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.25);
}

/* ===== SECTION HEADINGS ===== */
.section-heading {
    margin: 35px 0 15px;
    font-weight: 600;
}

/* ===== RECENT CARD ===== */
.recent-card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    color: #102a4d;
}

/* ===== WARNING BANNER ===== */
.warning-banner {
    background: #fff4e5;
    color: #8a5700;
    padding: 12px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
}

</style>
</head>

<body>

<div class="dashboard-container">

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">

        <h3>PrimeTrust</h3>

        <a href="{% url 'customer_dashboard' %}">Dashboard</a>
        <a href="{% url 'transaction_history' %}">Statements</a>
        <a href="{% url 'transfer' %}">Transfer Funds</a>
        <a href="{% url 'pay_bills' %}">Pay Bills</a>
        <a href="{% url 'manage_profile' %}">Manage Profile</a>
        <a href="{% url 'deposit' %}">Deposit</a>
        <a href="{% url 'withdraw' %}">Withdraw</a>

        <form method="POST" action="{% url 'logout' %}" class="mt-3">
            {% csrf_token %}
            <button type="submit" class="logout-btn">
                Logout
            </button>
        </form>

    </div>

    <!-- Main -->
    <div class="main-content">

        <!-- Alerts -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert-message {{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Top Bar -->
        <div class="top-bar">

            <button onclick="toggleSidebar()" class="btn btn-light btn-sm me-3">
                ‚ò∞
            </button>

            <div style="flex:1;">
                <h4 class="mb-0">Welcome Back, {{ name }} üëã</h4>
                <small style="opacity:0.6;">Here's your account overview</small>
            </div>

            <div class="profile-circle">
                {{ name|first|upper }}
            </div>

        </div>

        <!-- KYC Warning -->
        {% if not kyc or kyc.status != "Approved" %}
            <div class="warning-banner">
                ‚ö† Please complete KYC verification to unlock full banking features.
            </div>
        {% endif %}

        <!-- Balance -->
        <div class="balance-card">

            <small>Available Balance</small>
            <h1>‚Çπ {{ balance }}</h1>

            <small>Account No: {{ account_number }}</small><br>
            <small>IFSC Code: {{ ifsc }}</small>

        </div>

        <!-- Quick Actions -->
        <h5 class="section-heading">Quick Actions</h5>

        <div class="action-grid">

            <a href="{% url 'view_balance' %}" class="text-decoration-none">
                <div class="action-box">üí∞<h6>View Balance</h6></div>
            </a>

            <a href="{% url 'deposit' %}" class="text-decoration-none">
                <div class="action-box">‚ûï<h6>Deposit</h6></div>
            </a>

            <a href="{% url 'withdraw' %}" class="text-decoration-none">
                <div class="action-box">‚ûñ<h6>Withdraw</h6></div>
            </a>

            <a href="{% url 'transfer' %}" class="text-decoration-none">
                <div class="action-box">üîÅ<h6>Transfer Funds</h6></div>
            </a>

            <a href="{% url 'transaction_history' %}" class="text-decoration-none">
                <div class="action-box">üìú<h6>Statements</h6></div>
            </a>

            <a href="{% url 'pay_bills' %}" class="text-decoration-none">
                <div class="action-box">üßæ<h6>Pay Bills</h6></div>
            </a>

            <a href="{% url 'manage_profile' %}" class="text-decoration-none">
                <div class="action-box">‚öô<h6>Manage Profile</h6></div>
            </a>

        </div>

        <!-- ‚úÖ KYC SECTION (UNCHANGED LOGIC) -->
        <h5 class="section-heading">KYC Verification</h5>

        <div class="action-grid">

            {% if not kyc %}
                <a href="{% url 'upload_kyc' %}" class="text-decoration-none">
                    <div class="action-box">ü™™<h6>Upload KYC</h6></div>
                </a>

            {% elif kyc.status == "Pending" %}
                <div class="action-box">‚è≥<h6>KYC Pending</h6></div>

            {% elif kyc.status == "Rejected" %}
                <a href="{% url 'upload_kyc' %}" class="text-decoration-none">
                    <div class="action-box">‚ùå<h6>KYC Rejected - Reupload</h6></div>
                </a>

            {% elif kyc.status == "Approved" %}
                <div class="action-box">‚úÖ<h6>KYC Approved</h6></div>
            {% endif %}

        </div>

        <!-- ‚úÖ LOANS SECTION (UNCHANGED LOGIC) -->
        <h5 class="section-heading">Loans</h5>

        <div class="action-grid">

            <a href="{% url 'apply_loan' %}" class="text-decoration-none">
                <div class="action-box">üí≥<h6>Apply Loan</h6></div>
            </a>

            <a href="{% url 'my_loans' %}" class="text-decoration-none">
                <div class="action-box">üìã<h6>My Loans</h6></div>
            </a>

        </div>

        <!-- Recent Transactions -->
        <h5 class="section-heading">Recent Transactions</h5>

        <div class="recent-card">

            {% if recent_transactions %}
                {% for txn in recent_transactions %}
                    <div class="d-flex justify-content-between mb-2">

                        <div>
                            <strong>{{ txn.transaction_type }}</strong><br>
                            <small>{{ txn.created_at|date:"d M Y, H:i" }}</small>
                        </div>

                        <div>
                            ‚Çπ {{ txn.amount }}
                        </div>

                    </div>
                {% endfor %}
            {% else %}
                <p class="mb-0 text-center">
                    No recent transactions yet.
                </p>
            {% endif %}

        </div>

    </div>

</div>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");

    if (sidebar.style.display === "none") {
        sidebar.style.display = "block";
    } else {
        sidebar.style.display = "none";
    }
}
</script>

</body>
</html>
