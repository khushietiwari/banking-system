{% extends 'base_portal.html' %}
{% load static %}

{% block page_title %}My Cards Status | PrimeTrust{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <div class="elite-header border-0 pb-3 mb-4 d-flex justify-content-between align-items-center">
        <div>
            <span class="elite-subtitle">Account Services</span>
            <h4 class="elite-title mb-0">Card Application Status</h4>
        </div>
        <div class="text-end">
            <a href="{% url 'apply_debit_card' %}" class="btn btn-sm btn-outline-primary rounded-pill px-3 me-2">
                New Debit Card
            </a>
            <a href="{% url 'apply_credit_card' %}" class="btn btn-sm btn-primary-custom rounded-pill px-3">
                New Credit Card
            </a>
        </div>
    </div>

    <div class="elite-card">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead>
                    <tr class="text-uppercase small ls-1 text-muted">
                        <th class="ps-0">Card Type</th>
                        <th>Reference</th>
                        <th>Applied At</th>
                        <th>Reason</th>
                        <th class="text-end">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in card_requests %}
                    <tr>
                        <td class="ps-0">
                            <div class="d-flex align-items-center">
                                <div class="bg-skyblue bg-opacity-10 text-darkblue rounded-circle p-2 me-3"
                                    style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <span class="fw-bold text-dark small">
                                    {{ req.card_type }} Card
                                </span>
                            </div>
                        </td>
                        <td class="text-muted font-monospace small">
                            #CR-{{ req.id|stringformat:"04d" }}
                        </td>
                        <td class="text-muted small">
                            {{ req.applied_at|date:"M d, Y" }}
                        </td>
                        <td class="small text-muted"
                            style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ req.reason|default:"N/A" }}
                        </td>
                        <td class="text-end">
                            {% if req.status == 'Approved' %}
                            <button class="btn btn-sm btn-dark rounded-pill px-3 shadow-sm" type="button"
                                data-bs-toggle="collapse" data-bs-target="#card-{{ req.id }}">
                                <i class="fas fa-eye me-1"></i> View Card
                            </button>
                            {% else %}
                            <span
                                class="badge rounded-pill {% if req.status == 'Approved' %}bg-success{% elif req.status == 'Rejected' %}bg-danger{% else %}bg-warning{% endif %} bg-opacity-10 {% if req.status == 'Approved' %}text-success{% elif req.status == 'Rejected' %}text-danger{% else %}text-warning{% endif %} border-0 px-3">
                                {{ req.status }}
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% if req.status == 'Approved' %}
                    <tr class="collapse" id="card-{{ req.id }}">
                        <td colspan="5" class="py-4 bg-light bg-opacity-50">
                            <div class="d-flex justify-content-center">
                                <div class="virtual-card {% if req.card_type == 'Credit' %}credit-card-elite{% else %}debit-card-bg{% endif %} shadow-lg p-4 text-white position-relative overflow-hidden"
                                    style="width: 350px; height: 210px; border-radius: 15px;">

                                    {% if req.card_type == 'Credit' %}
                                    <!-- Geometric Pattern Overlay -->
                                    <div class="card-pattern"></div>
                                    {% endif %}

                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div class="small fw-light opacity-75 ls-1">{{ req.card_type }} card</div>
                                        <div class="h5 mb-0 fw-bold ls-1">BANK</div>
                                    </div>

                                    <!-- Chip and NFC -->
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="card-chip me-3"></div>
                                        <i class="fas fa-wifi fa-rotate-90 opacity-50 small"></i>
                                    </div>

                                    <!-- Card Number -->
                                    <div class="mb-3">
                                        <div class="h5 fw-bold font-monospace ls-2 mb-0"
                                            style="text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">
                                            {{ req.card_number }}
                                        </div>
                                        <div class="x-small opacity-50 font-monospace">1234</div>
                                    </div>

                                    <div class="d-flex justify-content-between align-items-end mt-auto">
                                        <div>
                                            <div class="text-uppercase x-small opacity-75 mb-1"
                                                style="font-size: 0.5rem;">Valid Thru</div>
                                            <div class="small fw-bold font-monospace">{{ req.expiry_date }}</div>
                                            <div class="mt-2">
                                                <div class="text-uppercase x-small ls-1 fw-bold">{{
                                                    request.user.get_full_name|default:request.user.username|upper }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="hologram"></div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endif %}
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <div class="opacity-10 mb-3">
                                <i class="fas fa-credit-card fa-4x"></i>
                            </div>
                            <p class="text-muted small mb-0">No card applications found.</p>
                            <div class="mt-4">
                                <a href="{% url 'apply_debit_card' %}"
                                    class="btn btn-primary-custom rounded-pill px-4">Apply for a Card</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .bg-skyblue {
        background-color: #87ceeb;
    }

    .text-darkblue {
        color: #00008b;
    }

    .virtual-card {
        transition: transform 0.3s ease;
        cursor: pointer;
    }

    .virtual-card:hover {
        transform: translateY(-5px) rotate(1deg);
    }

    .credit-card-elite {
        background: linear-gradient(135deg, #4b0082 0%, #d80073 50%, #a200ff 100%);
    }

    .card-pattern {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.15;
        background-image:
            linear-gradient(30deg, #ffffff 12%, transparent 12.5%, transparent 87%, #ffffff 87.5%, #ffffff),
            linear-gradient(150deg, #ffffff 12%, transparent 12.5%, transparent 87%, #ffffff 87.5%, #ffffff),
            linear-gradient(30deg, #ffffff 12%, transparent 12.5%, transparent 87%, #ffffff 87.5%, #ffffff),
            linear-gradient(150deg, #ffffff 12%, transparent 12.5%, transparent 87%, #ffffff 87.5%, #ffffff),
            linear-gradient(60deg, #ffffff 25%, transparent 25.5%, transparent 75%, #ffffff 75%, #ffffff),
            linear-gradient(60deg, #ffffff 25%, transparent 25.5%, transparent 75%, #ffffff 75%, #ffffff);
        background-size: 20px 35px;
        background-position: 0 0, 0 0, 10px 18px, 10px 18px, 0 0, 10px 18px;
    }

    .card-chip {
        width: 40px;
        height: 30px;
        background: linear-gradient(135deg, #ffd700 0%, #fdb931 50%, #cca42b 100%);
        border-radius: 5px;
        position: relative;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
    }

    .card-chip::after {
        content: "";
        position: absolute;
        top: 5px;
        left: 8px;
        right: 8px;
        bottom: 5px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 2px;
    }

    .hologram {
        width: 45px;
        height: 30px;
        background: linear-gradient(135deg, #e0e0e0 0%, #ffffff 50%, #bdbdbd 100%);
        border-radius: 4px;
        opacity: 0.8;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .debit-card-bg {
        background: linear-gradient(135deg, #1d976c 0%, #93f9b9 100%);
    }

    .ls-1 {
        letter-spacing: 1px;
    }

    .ls-2 {
        letter-spacing: 2px;
    }

    .x-small {
        font-size: 0.65rem;
    }
</style>
{% endblock %}